<!DOCTYPE html>
<html>

<head>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="transparent">
    <meta name="apple-mobile-web-app-title" content="Todo List">
    
    <title>Todo List Tracker</title>
    
</head>

<body>
    
    <div id="menu">
        <a href="#" onclick="loadNotepad('main')">main</a>
        <a href="#" onclick="loadNotepad('password')">password</a>
        <a href="#" onclick="loadNotepad('side')">side</a>
        <a href="#" onclick="loadNotepad('text')">text</a>
        <a href="#" onclick="firebase.auth().signOut();editor.setContent('')">logout</a>
    </div>
    <textarea id="textarea" rows="40" id="main"></textarea>
    

    <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
    <script src="https://cdn.rawgit.com/alertifyjs/alertify.js/v1.0.10/dist/js/alertify.js"></script>
    <script src="https://cdn.tinymce.com/4/tinymce.min.js"></script>
    
    <script>
        // init Firebase
        firebase.initializeApp({
            apiKey: "AIzaSyDJCb1IQlPbKwe87kayevz0Mri8QVlAKhE",
            authDomain: "todolist-1a1a7.firebaseapp.com",
            databaseURL: "https://todolist-1a1a7.firebaseio.com",
            storageBucket: "",
        });
        
        let ref = firebase.database().ref();
        let currentNotepad = 'main';
        let password;
        
        
        
        // when the auth stated changes, either execute logged in or logged out code
        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                // logged in
                loadNotepad('main');
            } else {
                // not logged in
                // prompt the user for the password
                alertify.prompt("Enter your password", (val, ev) => {
                    password = val;
                    ev.preventDefault();
                    
                    console.log(password);
                    // onAuthStateChanged will run again after login
                    firebase.auth().signInWithEmailAndPassword('a@a.com', password).catch(e => console.error(e));
                }, e => e.preventDefault());
            
                let alertInput = document.querySelectorAll('.alertify>.dialog>div>input')[0];
                // make the input type password
                alertInput.setAttribute('type', 'password');
                
                // "click" the ok button if enter is pressed
                alertInput.onkeydown = e => {
                    if (e.keyCode === 13) {
                        // click ok button
                        document.querySelectorAll('.alertify>.dialog>div>nav>.ok')[0].click();
                    }
                };
            }
        });
        
        
        // init tinyMCE
        let editor;
        tinymce.init({
            selector: 'textarea',
            toolbar: 'fontselect fontsizeselect | undo redo forecolor backcolor | alignleft aligncenter alignright alignjustify bold italic underline strikethrough | bullist numlist save-button',
            menu: {
                file: {title: 'File', items: 'print'},
                edit: {title: 'Edit', items: 'cut copy paste pastetext | selectall searchreplace'},
                insert: {title: 'Insert', items: 'charmap insertdatetime'},
                format: {title: 'Format', items: ' superscript subscript | formats | removeformat'},
                table: {title: 'Table', items: 'inserttable tableprops deletetable | cell row column'}
            },
            statusbar: false,
            plugins: 'autoresize table insertdatetime charmap textcolor colorpicker print searchreplace',
            autoresize_max_height: window.innerHeight - 110,
            setup: editor => {
                editor.addButton('save-button', {
                    text: 'Save',
                    icon: false,
                    onclick: () => {
                        if (password) {
                            // save notepad content
                            // ref.child(currentNotepad).set(document.querySelectorAll('#textarea_ifr').contentDocument.querySelectorAll('#tinymce').innerHTML);
                        }
                    }
                });
            }
        }).then(editors => {
            editor = editors[0];
        });
        
        
        function loadNotepad(notepad) {
            currentNotepad = notepad;
            ref.child(currentNotepad).once('value', snapshot => editor.setContent(snapshot.val()));
        }
    </script>
</body>

</html>