<!DOCTYPE html>
<html>

<head>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Todo List">
    
    <title>Todo List Tracker</title>
    
</head>

<body>
    
    <textarea id="textarea" rows="40" id="main"></textarea>
    

    <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
    <script src="https://cdn.rawgit.com/bitwiseshiftleft/sjcl/master/sjcl.js"></script>
    <script src="https://cdn.tinymce.com/4/tinymce.min.js"></script>
    
    <script>
        /* global firebase */
        /* global sjcl */
        /* global tinymce */
        
        
        // Initialize Firebase
        firebase.initializeApp({
            apiKey: "AIzaSyDJCb1IQlPbKwe87kayevz0Mri8QVlAKhE",
            authDomain: "todolist-1a1a7.firebaseapp.com",
            databaseURL: "https://todolist-1a1a7.firebaseio.com",
            storageBucket: "",
        });
        
        var ref = firebase.database().ref();
        var password = prompt('Please enter your password!');
        if (!password) {
            throw new Error('Please enter a password');
        }
        
        
        // init tinyMCE
        var t;
        tinymce.init({
            selector: 'textarea',
            toolbar: 'fontselect, fontsizeselect | undo, redo, bold, italic, underline, strikethrough | alignleft, aligncenter, alignright, alignjustify, bullist, numlist, save-button',
            statusbar: false,
            plugins: 'autoresize',
            autoresize_max_height: window.innerHeight - 90,
            setup: function(editor) {
                editor.addButton('save-button', {
                    text: 'Save',
                    icon: false,
                    onclick: saveInfo
                });
            }
        }).then(function(editor) {
            t = editor[0];
            
            
            // init data
            ref.child('text').once('value', function(snapshot) {
                try {
                    t.setContent(sjcl.decrypt(password, JSON.stringify(JSON.parse(snapshot.val()))));
                } catch (e) {
                    console.error(e);
                    alert('Wrong password!');
                }
            });
        });
        
        
        function saveInfo() {
            ref.set({
                text: sjcl.encrypt(password, t.getContent())
            });
        }
    </script>
</body>

</html>