<!DOCTYPE html>
<html>

<head>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="transparent">
    <meta name="apple-mobile-web-app-title" content="Todo List">
    
    <title>Todo List Tracker</title>
    
</head>

<body>
    
    <div id="menu">
        <a href="#" id="link-main">main</a>
        <a href="#" id="link-password">password</a>
        <a href="#" id="link-side">side</a>
        <a href="#" id="link-text">text</a>
    </div>
    <textarea id="textarea" rows="40" id="main"></textarea>
    

    <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
    <script src="https://cdn.rawgit.com/alertifyjs/alertify.js/v1.0.10/dist/js/alertify.js"></script>
    <script src="https://cdn.tinymce.com/4/tinymce.min.js"></script>
    
    <script>
        /* global firebase */
        /* global tinymce */
        /* global alertify */
        
        
        // Initialize Firebase
        firebase.initializeApp({
            apiKey: "AIzaSyDJCb1IQlPbKwe87kayevz0Mri8QVlAKhE",
            authDomain: "todolist-1a1a7.firebaseapp.com",
            databaseURL: "https://todolist-1a1a7.firebaseio.com",
            storageBucket: "",
        });
        
        var ref = firebase.database().ref();
        var password;
        var currentNotepad = 'main';
        
        
        
        alertify.prompt("Enter your password", function(val, ev) {
                ev.preventDefault();
                password = val;
                // document.cookie = "login=true; expires=1 Jan 2030 12:00:00 UTC";
                if (document.cookie.search('login=true;') > -1) {
                    password = window.btoa('T3JuZjAyT0s=');
                }
                
                firebase.auth().signInWithEmailAndPassword('a@a.com', password).then(function() {
                    // init data
                    loadNotepad('main');
                }).catch(function(error) {
                    alertify.alert(error.message);
                });
            }, function(ev) {
                ev.preventDefault();
            }
        );
        
        
        
        // init tinyMCE
        var editor;
        tinymce.init({
            selector: 'textarea',
            toolbar: 'fontselect fontsizeselect | undo redo forecolor backcolor | alignleft aligncenter alignright alignjustify bold italic underline strikethrough | bullist numlist save-button',
            menu: {
                file: {title: 'File', items: 'print'},
                edit: {title: 'Edit', items: 'cut copy paste pastetext | selectall searchreplace'},
                insert: {title: 'Insert', items: 'charmap insertdatetime'},
                format: {title: 'Format', items: ' superscript subscript | formats | removeformat'},
                table: {title: 'Table', items: 'inserttable tableprops deletetable | cell row column'}
            },
            statusbar: false,
            plugins: 'autoresize table insertdatetime charmap textcolor colorpicker print searchreplace',
            autoresize_max_height: window.innerHeight - 110,
            setup: function(editor) {
                editor.addButton('save-button', {
                    text: 'Save',
                    icon: false,
                    onclick: function() {
                        if (password) {
                            // save notepad content
                            ref.child(currentNotepad).set(document.getElementById('textarea_ifr').contentDocument.getElementById('tinymce').innerHTML);
                        }
                    }
                });
            }
        }).then(function(editors) {
            editor = editors[0];
        });
        
        
        
        var alertInput = document.querySelectorAll('.alertify>.dialog>div>input')[0];
        
        // make the input type password
        alertInput.setAttribute('type', 'password');
        
        alertInput.onkeydown = function(e) {
            if (e.keyCode === 13) {
                // click ok button
                document.querySelectorAll('.alertify>.dialog>div>nav>.ok')[0].click();
            }
        };
        
        
        
        document.getElementById('link-main').onclick = function() {
            loadNotepad('main');
        };
        document.getElementById('link-password').onclick = function() {
            loadNotepad('password');
        };
        document.getElementById('link-side').onclick = function() {
            loadNotepad('side');
        };
        document.getElementById('link-text').onclick = function() {
            loadNotepad('text');
        };
        
        
        
        function loadNotepad(notepad) {
            currentNotepad = notepad;
            ref.child(currentNotepad).once('value', function(snapshot) {
                editor.setContent(snapshot.val());
            });
        }
    </script>
</body>

</html>